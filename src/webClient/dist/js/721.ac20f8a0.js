"use strict";(self["webpackChunkCompanyName"]=self["webpackChunkCompanyName"]||[]).push([[721],{44721:(e,t,s)=>{s.r(t),s.d(t,{default:()=>y});var a=s(34182);const i={key:0,class:"q-mt-sm"},l={class:"row q-col-gutter-md q-mb-sm"};function r(e,t,s,r,n,o){const m=(0,a.up)("comp-breadcrumb"),u=(0,a.up)("comp-fld"),d=(0,a.up)("telegram-login"),c=(0,a.up)("comp-item-btn-save"),p=(0,a.up)("q-page");return(0,a.wg)(),(0,a.j4)(p,{padding:""},{default:(0,a.w5)((()=>[(0,a.Wm)(m,{list:[{label:"Редактирование профиля"}]}),n.item?((0,a.wg)(),(0,a.j4)("div",i,[((0,a.wg)(!0),(0,a.j4)(a.HY,null,(0,a.Ko)(n.flds,(e=>((0,a.wg)(),(0,a.j4)("div",l,[((0,a.wg)(!0),(0,a.j4)(a.HY,null,(0,a.Ko)(e,(e=>((0,a.wg)(),(0,a.j4)(u,{key:e.name,fld:n.item[e.name],type:e.type,onUpdate:t=>n.item[e.name]=t,label:e.label,selectOptions:e.selectOptions?e.selectOptions():[],ajaxSelectTitle:n.item[e.ajaxSelectTitle],columnClass:e.columnClass,compName:e.compName,ext:e.ext},null,8,["fld","type","onUpdate","label","selectOptions","ajaxSelectTitle","columnClass","compName","ext"])))),128))])))),256)),e.$config.telegram&&e.$config.telegram.botName?((0,a.wg)(),(0,a.j4)(d,{key:0,isRegistered:e.currentUser.options.telegram_id},null,8,["isRegistered"])):(0,a.kq)("",!0),(0,a.Wm)(c,{onSave:o.save,onCancel:t[1]||(t[1]=t=>e.$router.push(o.docUrl))},null,8,["onSave"])])):(0,a.kq)("",!0)])),_:1})}function n(e,t,s,i,l,r){const n=(0,a.up)("vue-telegram-login");return(0,a.wg)(),(0,a.j4)("div",null,[(0,a.Wm)(n,{mode:"callback","telegram-login":e.$config.telegram.botName,size:"medium",onCallback:r.cb},null,8,["telegram-login","onCallback"])])}const o={ref:"telegram"};function m(e,t,s,i,l,r){return(0,a.wg)(),(0,a.j4)("div",o,null,512)}const u={name:"vue-telegram-login",props:{mode:{type:String,required:!0,validator(e){return["callback","redirect"].includes(e)}},telegramLogin:{type:String,required:!0,validator(e){return e.endsWith("bot")||e.endsWith("Bot")}},redirectUrl:{type:String,default:""},requestAccess:{type:String,default:"read",validator(e){return["read","write"].includes(e)}},size:{type:String,default:"large",validator(e){return["small","medium","large"].includes(e)}},userpic:{type:Boolean,default:!0},radius:{type:String}},methods:{onTelegramAuth(e){this.$emit("callback",e)}},mounted(){const e=document.createElement("script");e.async=!0,e.src="https://telegram.org/js/telegram-widget.js?9",e.setAttribute("data-size",this.size),e.setAttribute("data-userpic",this.userpic),e.setAttribute("data-telegram-login",this.telegramLogin),e.setAttribute("data-request-access",this.requestAccess),this.radius&&e.setAttribute("data-radius",this.radius),"callback"===this.mode?(window.onTelegramAuth=this.onTelegramAuth,e.setAttribute("data-onauth","window.onTelegramAuth(user)")):e.setAttribute("data-auth-url",this.redirectUrl),this.$refs.telegram.appendChild(e)}};u.render=m;const d=u,c={props:["isRegistered"],components:{vueTelegramLogin:d},data(){return{isDone:!1}},methods:{cb(e){this.isRegistered||this.isDone||this.$utils.postApiRequest({url:"/api/telegram_auth",params:JSON.stringify(e)}).subscribe((e=>{e.ok&&(this.isDone=!1,this.$q.notify({message:"аккаунт в телеграм успешно зарегестрирован",type:"positive",position:"bottom-right"}))}))}}};c.render=n;const p=c;var g=s(43015);const h={mixins:[g.Z],components:{telegramLogin:p},computed:{docUrl:()=>"/"},data(){return{item:null,flds:[[{name:"last_name",type:"string",label:"Фамилия",required:!0},{name:"first_name",type:"string",label:"Имя",required:!0}],[{name:"phone",type:"phone",label:"Телефон"}],[{name:"avatar",compName:"comp-fld-img",label:"Фото",ext:{fldName:"avatar",uploadUrl:"upload_profile_image",methodUpdate:"current_user_update"},columnClass:"col-xs-6 col-sm-6 col-md-2"}]],optionsFlds:[]}},methods:{save(){this.$utils.saveItem.call(this,{method:"current_user_update",itemForSaveMod:{options:Object.assign(this.item.options||{})},resultModify:e=>(this.login(),this.optionsFlds&&this.optionsFlds.map((t=>e[t]=e.options[t])),e)})}},mounted(){this.item=this.currentUser,this.optionsFlds&&this.optionsFlds.map((e=>this.item[e]=this.item.options[e]))}};var b=s(24379),f=s(7518),v=s.n(f);h.render=r;const y=h;v()(h,"components",{QPage:b.Z})}}]);